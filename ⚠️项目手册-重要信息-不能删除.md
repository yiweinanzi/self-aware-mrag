# âš ï¸ é¡¹ç›®æ‰‹å†Œ - é‡è¦ä¿¡æ¯ ã€ä¸èƒ½åˆ é™¤ / ä¸èƒ½å½’æ¡£ã€‘

**æœ€åæ›´æ–°**: 2025-10-31 23:35  
**é‡è¦çº§åˆ«**: â­â­â­â­â­  
**GitHubä»“åº“**: https://github.com/yiweinanzi/self-aware-mrag

**ğŸ”¥ æœ€æ–°å˜æ›´ (2025-10-31)**:
- âœ… åˆ‡æ¢åˆ°CrossModalUncertaintyEstimatorï¼ˆè®ºæ–‡å®Œæ•´å®ç°ï¼‰
- âœ… ä½¿ç”¨GramçŸ©é˜µ + eigen_score + JSæ•£åº¦ï¼ˆä»£æ›¿ç®€åŒ–ç‰ˆï¼‰
- âœ… æ ¹ç›®å½•æ¸…ç†å®Œæˆï¼Œæ–‡æ¡£å·²å½’æ¡£åˆ° `_DOCS/`
- ğŸ”„ å…¨æ•°æ®é›†å®éªŒé‡æ–°å¯åŠ¨ï¼ˆä½¿ç”¨è®ºæ–‡å®Œæ•´å®ç°ï¼‰

**ğŸ“‹ å¿«é€Ÿå¯¼èˆª**:
- [å¿…è¯»è§„åˆ™](#-å¿…è¯»è§„åˆ™)
- [æ ¸å¿ƒé—®é¢˜ä¿®æ­£](#1-æ ¸å¿ƒé—®é¢˜ä¿®æ­£-2025-10-31)
- [è¯­æ–™åº“å’Œç´¢å¼•ä½ç½®](#2-è¯­æ–™åº“å’Œç´¢å¼•ä½ç½®ä¸è¦ç¼–é€ )
- [æ ¸å¿ƒä»£ç ä½ç½®](#3-æ ¸å¿ƒä»£ç ä½ç½®ç´¢å¼•-)
- [æ–‡æ¡£å½’æ¡£è¯´æ˜](#4-æ–‡æ¡£å½’æ¡£è¯´æ˜-new)
- [æœ€æ–°å®éªŒè¿›åº¦](#5-æœ€æ–°å®éªŒè¿›åº¦)

---

## 1. æ ¸å¿ƒé—®é¢˜ä¿®æ­£ (2025-10-31)

### âš ï¸ å‘ç°å¹¶ä¿®å¤çš„å…³é”®é—®é¢˜

**é—®é¢˜**ï¼šå®éªŒä½¿ç”¨äº†é”™è¯¯çš„ä¸ç¡®å®šæ€§ä¼°è®¡å™¨ï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™

| ç‰ˆæœ¬ | U_text | U_visual | U_align | 100æ ·æœ¬EM | 1353æ ·æœ¬EM |
|------|--------|----------|---------|-----------|------------|
| **ImprovedUncertaintyEstimator** (ç®€åŒ–ç‰ˆ) | å…³é”®è¯åŒ¹é… | CLIPç‰¹å¾ | CLIPç›¸ä¼¼åº¦ | 62.0% | 48.7% âŒ |
| **CrossModalUncertaintyEstimator** (è®ºæ–‡å®Œæ•´å®ç°) | GramçŸ©é˜µ+eigen_score | Attention variance | JSæ•£åº¦ | é¢„è®¡63-65% | é¢„è®¡55-60% âœ… |

**ä¿®æ”¹è®°å½•**ï¼š
- ä¿®æ”¹æ–‡ä»¶ï¼š`FlashRAG/experiments/run_all_baselines_100samples.py`
- ä¿®æ”¹å†…å®¹ï¼š`'use_improved_estimator': False`
- å¤‡ä»½ä½ç½®ï¼š`_BACKUP_ImprovedEstimator_2025-10-31/`
- è¯¦ç»†æ–‡æ¡£ï¼š`_DOCS/reports/ğŸ“ä¿®æ”¹è®°å½•-åˆ‡æ¢åˆ°å®Œæ•´å®ç°.md`

---

## 2. è¯­æ–™åº“å’Œç´¢å¼•ä½ç½®ï¼ˆä¸è¦ç¼–é€ ï¼ï¼‰

### **å½“å‰çœŸå®è·¯å¾„ï¼ˆ2025-10-30æ›´æ–°ï¼‰**

**âš ï¸ é‡è¦å˜æ›´ï¼šå·²æ”¹ç”¨çº¯Wikipedia 300ä¸‡è¯­æ–™åº“**

**å½“å‰è¯­æ–™åº“**:
```
è·¯å¾„: /root/autodl-tmp/FlashRAG/corpus/corpus_wiki_3m.jsonl
å¤§å°: ~1.5GB
æ–‡æ¡£æ•°: 3,000,000
æ¥æº: 100% Wikipedia (å–å‰300ä¸‡æ¡)
æ„å»ºè„šæœ¬: FlashRAG/tools/build_corpus_wiki_only_3m.py
```

**å½“å‰ç´¢å¼•**:
```
ç›®å½•: /root/autodl-tmp/FlashRAG/indexes/wiki_3m/bge/
â”œâ”€â”€ e5_Flat.index       # BGEæ–‡æœ¬ç´¢å¼• (å·²æ„å»ºå®Œæˆ)
â””â”€â”€ emb_e5.memmap       # åµŒå…¥å‘é‡
æ„å»ºè„šæœ¬: FlashRAG/tools/rebuild_index_wiki_3m.py
```

**åŸå§‹æ•°æ®**:
```
Wikipedia TSV: /root/autodl-tmp/data/wikipedia/psgs_w100.tsv
  - å¤§å°: 13GB
  - æ€»æ–‡æ¡£æ•°: 21,015,325 æ¡
  - ä½¿ç”¨: å‰ 3,000,000 æ¡
```

**âš ï¸ å·²åºŸå¼ƒï¼ˆä¸è¦ä½¿ç”¨ï¼‰**:
- âŒ `corpus/corpus_3m_real.jsonl` (æ··åˆè¯­æ–™åº“) 
- âŒ `indexes/3m_real/` (æ··åˆè¯­æ–™åº“ç´¢å¼•)
- âŒ CC3Mç›¸å…³æ–‡ä»¶ï¼ˆå› ç£ç›˜ç©ºé—´ä¸è¶³å·²å–æ¶ˆï¼‰

---

## 3. æ ¸å¿ƒä»£ç ä½ç½®ï¼ˆç´¢å¼•ï¼‰ ğŸ”

### 3.1 Self-Aware-MRAG (Our Method)

**ä¸»è¦Pipeline**:
```
/root/autodl-tmp/FlashRAG/flashrag/pipeline/self_aware_pipeline_qwen3vl.py
```
- æ ¸å¿ƒåˆ›æ–°ï¼šè·¨æ¨¡æ€ä¸ç¡®å®šæ€§ + è‡ªé€‚åº”æ£€ç´¢ + ä½ç½®èåˆ
- ä½¿ç”¨æ¨¡å‹ï¼šQwen3-VL-8B-Instruct
- å½“å‰é…ç½®ï¼šä½¿ç”¨CrossModalUncertaintyEstimatorï¼ˆè®ºæ–‡å®Œæ•´å®ç°ï¼‰

**æ ¸å¿ƒæ¨¡å—**:
```
/root/autodl-tmp/FlashRAG/flashrag/modules/
â”œâ”€â”€ uncertainty_estimator.py              # âœ… CrossModalUncertaintyEstimatorï¼ˆè®ºæ–‡å®Œæ•´å®ç°ï¼‰
â”œâ”€â”€ uncertainty_estimator_improved.py     # âš ï¸ ImprovedUncertaintyEstimatorï¼ˆç®€åŒ–ç‰ˆï¼Œå·²å¼ƒç”¨ï¼‰
â”œâ”€â”€ position_aware_fusion.py              # ä½ç½®æ„ŸçŸ¥èåˆ
â”œâ”€â”€ attribution.py                        # ç»†ç²’åº¦å½’å› 
â”œâ”€â”€ qwen3_vl.py                          # Qwen3-VLå°è£…
â””â”€â”€ query_reformulator.py                 # æŸ¥è¯¢å¢å¼º
```

### 3.2 Baselineæ–¹æ³•ï¼ˆ7ä¸ªå¯¹æ¯”æ–¹æ³•ï¼‰

**Baselineå®ç°ä½ç½®**:
```
/root/autodl-tmp/FlashRAG/experiments/baselines/
â”œâ”€â”€ selfrag_enhanced.py      # Self-RAG (Adaptive Retrieval + Reflection)
â”œâ”€â”€ mr2ag_enhanced.py        # mRÂ²AG (Multi-Round + Hierarchical)
â”œâ”€â”€ visrag_enhanced.py       # VisRAG (BGE Reranker)
â”œâ”€â”€ reveal_enhanced.py       # REVEAL (Two-stage Reasoning)
â”œâ”€â”€ murag_enhanced.py        # MuRAG (FiD Parallel + Voting)
â””â”€â”€ ragvl_enhanced.py        # RagVL (MLLM Reranker)
```

**è¯´æ˜**ï¼šæ‰€æœ‰baselineå·²æŒ‰ç…§åŸè®ºæ–‡å®Œæ•´å®ç°

### 3.3 å®éªŒè„šæœ¬

**ä¸»å®éªŒè„šæœ¬**:
```
/root/autodl-tmp/FlashRAG/experiments/run_all_baselines_100samples.py
```
- 7ä¸ªæ–¹æ³•å¯¹æ¯”å®éªŒ
- æ”¯æŒ100æ ·æœ¬æˆ–å…¨æ•°æ®é›†ï¼ˆ1353æ ·æœ¬ï¼‰
- 7ä¸ªæ ¸å¿ƒè¯„æµ‹æŒ‡æ ‡

---

## 4. æ–‡æ¡£å½’æ¡£è¯´æ˜ (NEW)

### å½’æ¡£ç›®å½•ç»“æ„

```
/root/autodl-tmp/
â”œâ”€â”€ README.md                                   # é¡¹ç›®ä»‹ç»
â”œâ”€â”€ âš ï¸é¡¹ç›®æ‰‹å†Œ-é‡è¦ä¿¡æ¯-ä¸èƒ½åˆ é™¤.md              # æœ¬æ‰‹å†Œï¼ˆé‡è¦ï¼ï¼‰
â”œâ”€â”€ full_dataset_CrossModal_experiment.log     # å½“å‰å®éªŒæ—¥å¿—
â”‚
â”œâ”€â”€ _DOCS/                                     # ğŸ“š æ–‡æ¡£å½’æ¡£ç›®å½•
â”‚   â”œâ”€â”€ README.md                              # å½’æ¡£è¯´æ˜
â”‚   â”œâ”€â”€ reports/                               # ğŸ“Š åˆ†ææŠ¥å‘Š
â”‚   â”‚   â”œâ”€â”€ âœ…è®ºæ–‡å®ç°å®Œæ•´æ€§æ£€æŸ¥æŠ¥å‘Š.md
â”‚   â”‚   â”œâ”€â”€ âš ï¸å…¨æ•°æ®é›†æ€§èƒ½ä¸‹é™åˆ†æ.md
â”‚   â”‚   â”œâ”€â”€ ğŸ“ä¿®æ”¹è®°å½•-åˆ‡æ¢åˆ°å®Œæ•´å®ç°.md
â”‚   â”‚   â””â”€â”€ ... (å…¶ä»–æŠ¥å‘Š)
â”‚   â”œâ”€â”€ scripts/                               # ğŸ”§ æµ‹è¯•è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ monitor_full_experiment.sh
â”‚   â”‚   â”œâ”€â”€ test_all_7methods_10samples.py
â”‚   â”‚   â””â”€â”€ ... (å…¶ä»–è„šæœ¬)
â”‚   â””â”€â”€ logs/                                  # ğŸ“ æ—§å®éªŒæ—¥å¿—
â”‚       â”œâ”€â”€ run_100samples_*.log
â”‚       â””â”€â”€ ... (å…¶ä»–æ—¥å¿—)
â”‚
â””â”€â”€ _BACKUP_ImprovedEstimator_2025-10-31/      # ğŸ’¾ å¤‡ä»½ç›®å½•
    â”œâ”€â”€ README.md                               # å¤‡ä»½è¯´æ˜
    â”œâ”€â”€ run_all_baselines_100samples.py.backup
    â”œâ”€â”€ self_aware_pipeline_qwen3vl.py.backup
    â””â”€â”€ full_dataset_experiment_ImprovedEst.log
```

### å½’æ¡£åŸåˆ™

1. **æ ¹ç›®å½•**: åªä¿ç•™æ´»è·ƒçš„å®éªŒæ—¥å¿—å’Œé‡è¦æ‰‹å†Œ
2. **_DOCS/reports/**: å·²å®Œæˆçš„åˆ†ææŠ¥å‘Š
3. **_DOCS/scripts/**: ä¸´æ—¶æµ‹è¯•è„šæœ¬
4. **_DOCS/logs/**: å·²å®Œæˆçš„å®éªŒæ—¥å¿—
5. **_BACKUP_*/**: ä»£ç å¤‡ä»½å’Œå¯¹åº”çš„å®éªŒç»“æœ

---

## 5. æœ€æ–°å®éªŒè¿›åº¦

### 5.1 å½“å‰å®éªŒ (2025-10-31 23:03 å¯åŠ¨)

**é…ç½®**:
- æ•°æ®é›†ï¼šMRAG-Bench å…¨æ•°æ®é›†ï¼ˆ1353æ ·æœ¬ï¼‰
- æ–¹æ³•ï¼šSelf-Aware-MRAG + 6ä¸ªbaseline
- ä¸ç¡®å®šæ€§ä¼°è®¡å™¨ï¼š**CrossModalUncertaintyEstimator**ï¼ˆè®ºæ–‡å®Œæ•´å®ç°ï¼‰âœ…

**æ—¥å¿—**:
```bash
tail -f /root/autodl-tmp/full_dataset_CrossModal_experiment.log
```

**é¢„è®¡æ—¶é—´**:
- Self-Aware-MRAG: ~12.4å°æ—¶
- å…¨éƒ¨7ä¸ªæ–¹æ³•: ~96å°æ—¶ï¼ˆçº¦4å¤©ï¼‰

**é¢„æœŸç»“æœ**:
- Self-Aware-MRAG EM: 55-60%ï¼ˆvs ä¹‹å‰48.7%ï¼Œé¢„è®¡æå‡+6-11%ï¼‰
- åŸºäºè®ºæ–‡å®Œæ•´å®ç°çš„GramçŸ©é˜µ + eigen_score + JSæ•£åº¦

### 5.2 å†å²å®éªŒè®°å½•

| å®éªŒ | ä¼°è®¡å™¨ | 100æ ·æœ¬EM | 1353æ ·æœ¬EM | çŠ¶æ€ |
|------|--------|-----------|------------|------|
| ç¬¬ä¸€è½® | ImprovedUncertaintyEstimator | 62.0% | 48.7% | âŒ æ€§èƒ½ä¸‹é™ |
| ç¬¬äºŒè½® | CrossModalUncertaintyEstimator | é¢„è®¡63-65% | é¢„è®¡55-60% | ğŸ”„ è¿›è¡Œä¸­ |

**å¤‡ä»½ä½ç½®**: `/root/autodl-tmp/_BACKUP_ImprovedEstimator_2025-10-31/`

---

## 6. è®ºæ–‡å…³é”®åˆ›æ–°å®ç°çŠ¶æ€

### åˆ›æ–°1: è·¨æ¨¡æ€ä¸ç¡®å®šæ€§æ„ŸçŸ¥ âœ…

| ç»„ä»¶ | è®ºæ–‡è¦æ±‚ | CrossModalUncertaintyEstimator | å®ç°çŠ¶æ€ |
|------|---------|-------------------------------|---------|
| U_text | GramçŸ©é˜µ + eigen_score | âœ… Line 427-460 | âœ… å®Œæ•´å®ç° |
| U_visual | Attention variance | âœ… Line 236-272 | âœ… å®Œæ•´å®ç° |
| U_align | JSæ•£åº¦ | âœ… Line 274-309, 493-525 | âœ… å®Œæ•´å®ç° |

**æ–‡ä»¶ä½ç½®**: 
```
/root/autodl-tmp/FlashRAG/flashrag/modules/uncertainty_estimator.py
```

### åˆ›æ–°2: ä¸ç¡®å®šæ€§é©±åŠ¨çš„è‡ªé€‚åº”æ£€ç´¢ âœ…

- âœ… è¾“å…¥ä¸‰ç§ä¸ç¡®å®šæ€§åˆ†æ•°
- âœ… è¾“å‡ºæ£€ç´¢ç­–ç•¥ï¼ˆä¸æ£€ç´¢/æ–‡æœ¬/å›¾åƒ/bothï¼‰
- âœ… å‡å°‘30%+æ— æ•ˆæ£€ç´¢ï¼ˆå®é™…è¾¾åˆ°34.6%-40%ï¼‰

### åˆ›æ–°3: ä½ç½®å»åçš„è¯æ®èåˆ âš ï¸

- âœ… ä½ç½®åŠ æƒæ€æƒ³
- âš ï¸ ç®€å•æ’åºï¼ˆæœªå®ç°Uå‹é‡æ’åºï¼‰

---

## 7. å¿…è¯»è§„åˆ™

### 7.1 è¿è¡Œä»£ç å¿…é¡»ä½¿ç”¨condaç¯å¢ƒ

```bash
# âŒ é”™è¯¯
python experiments/xxx.py

# âœ… æ­£ç¡®
conda activate multirag && python experiments/xxx.py
```

**ç¯å¢ƒåç§°**: `multirag`  
**åŒ…å«**: torch, transformers, datasets, faiss, flashragç­‰

### 7.2 æŸ¥çœ‹å®éªŒè¿›åº¦

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f /root/autodl-tmp/full_dataset_CrossModal_experiment.log

# æŸ¥çœ‹è¿›åº¦ï¼ˆä½¿ç”¨ç›‘æ§è„šæœ¬ï¼‰
/root/autodl-tmp/monitor_full_experiment.sh

# æŸ¥çœ‹ä¼°è®¡å™¨ç±»å‹
grep "ä½¿ç”¨.*ä¸ç¡®å®šæ€§ä¼°è®¡å™¨" /root/autodl-tmp/full_dataset_CrossModal_experiment.log
```

### 7.3 å…³é”®é…ç½®å‚æ•°

**ä¸ç¡®å®šæ€§ä¼°è®¡å™¨**:
```python
# è®ºæ–‡å®Œæ•´å®ç°ï¼ˆå½“å‰ä½¿ç”¨ï¼‰
'use_improved_estimator': False  # CrossModalUncertaintyEstimator

# ç®€åŒ–ç‰ˆï¼ˆå·²å¼ƒç”¨ï¼‰
'use_improved_estimator': True   # ImprovedUncertaintyEstimator
```

**å…¶ä»–æ ¸å¿ƒå‚æ•°**:
```python
'uncertainty_threshold': 0.35      # ä¸ç¡®å®šæ€§é˜ˆå€¼
'use_position_fusion': True        # ä½ç½®æ„ŸçŸ¥èåˆ
'use_attribution': True            # ç»†ç²’åº¦å½’å› 
'retrieval_topk': 5               # æ£€ç´¢Top-K
```

---

## 8. é‡è¦é“¾æ¥å’Œèµ„æº

**GitHubä»“åº“**: https://github.com/yiweinanzi/self-aware-mrag

**å…³é”®æ–‡æ¡£**:
- è®ºæ–‡å®ç°æ£€æŸ¥ï¼š`_DOCS/reports/âœ…è®ºæ–‡å®ç°å®Œæ•´æ€§æ£€æŸ¥æŠ¥å‘Š.md`
- ä¿®æ”¹è®°å½•ï¼š`_DOCS/reports/ğŸ“ä¿®æ”¹è®°å½•-åˆ‡æ¢åˆ°å®Œæ•´å®ç°.md`
- æ€§èƒ½åˆ†æï¼š`_DOCS/reports/âš ï¸å…¨æ•°æ®é›†æ€§èƒ½ä¸‹é™åˆ†æ.md`

**å¤‡ä»½å’Œæ¢å¤**:
```bash
# æŸ¥çœ‹å¤‡ä»½
ls /root/autodl-tmp/_BACKUP_ImprovedEstimator_2025-10-31/

# æ¢å¤åˆ°ç®€åŒ–ç‰ˆï¼ˆä¸æ¨èï¼‰
cp /root/autodl-tmp/_BACKUP_ImprovedEstimator_2025-10-31/run_all_baselines_100samples.py.backup \
   /root/autodl-tmp/FlashRAG/experiments/run_all_baselines_100samples.py
```

---

## 9. å¸¸è§é—®é¢˜ (FAQ)

**Q: ä¸ºä»€ä¹ˆæ€§èƒ½ä»62%é™åˆ°48.7%ï¼Ÿ**
A: ä½¿ç”¨äº†é”™è¯¯çš„ImprovedUncertaintyEstimatorï¼ˆå…³é”®è¯åŒ¹é…ï¼‰ï¼Œåœ¨å¤§è§„æ¨¡æ•°æ®ä¸Šè¯¯åˆ¤ç‡é«˜ã€‚å·²åˆ‡æ¢åˆ°CrossModalUncertaintyEstimatorï¼ˆè®ºæ–‡å®Œæ•´å®ç°ï¼‰ã€‚

**Q: å¦‚ä½•éªŒè¯ä½¿ç”¨çš„æ˜¯å“ªä¸ªä¼°è®¡å™¨ï¼Ÿ**
A: æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
grep "ä½¿ç”¨.*ä¸ç¡®å®šæ€§ä¼°è®¡å™¨" full_dataset_CrossModal_experiment.log
# åº”è¯¥çœ‹åˆ°ï¼šâœ… ä½¿ç”¨åŸå§‹ä¸ç¡®å®šæ€§ä¼°è®¡å™¨ (CrossModalUncertaintyEstimator)
```

**Q: å®éªŒéœ€è¦å¤šä¹…ï¼Ÿ**
A: å…¨æ•°æ®é›†ï¼ˆ1353æ ·æœ¬ï¼Œ7ä¸ªæ–¹æ³•ï¼‰çº¦96å°æ—¶ï¼ˆ4å¤©ï¼‰ã€‚Self-Aware-MRAGéƒ¨åˆ†çº¦12.4å°æ—¶ã€‚

**Q: å¦‚ä½•åœæ­¢å®éªŒï¼Ÿ**
A: 
```bash
pkill -f "run_all_baselines_100samples.py"
```

---

**ğŸ“Œ æé†’**: æœ¬æ‰‹å†ŒæŒç»­æ›´æ–°ï¼Œæ¯æ¬¡é‡å¤§å˜æ›´åè¯·æ›´æ–°"æœ€åæ›´æ–°"æ—¶é—´å’Œ"æœ€æ–°å˜æ›´"éƒ¨åˆ†ï¼

**ğŸ”’ é‡è¦**: æœ¬æ–‡ä»¶ä¸èƒ½åˆ é™¤ã€ä¸èƒ½å½’æ¡£ã€ä¸èƒ½ç§»åŠ¨ï¼

